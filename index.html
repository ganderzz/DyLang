<html>
    <head>
        <title>DyLang</title>

        <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/foundation/6.3.1/css/foundation-flex.min.css">
        <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
    </head>
    <body>
        <div class="row" style="margin-top: 20px;">
            <div class="small-6 columns">
                <textarea id="code" style="height: 70vh;">
##
DyLang programming language

Can call functions using: (functionname param1 param2 ...)
Functions can be vanilla JavaScript functions!

Assign variables using $ symbol: $a = 5
Use variables: $a
#

$a = (add (add 'hello' ', ') 'world!')
(console.log $a)</textarea>
            </div>

            <div class="small-6 columns">
                <span class="label secondary">Result</span>

                <div id="code__result"></div>
            </div>
        </div>

        <div class="row">
            <div class="small-6 columns">
                <button type="button" class="button expanded">Compile</button>
            </div>
        </div>

        <hr />

        <div class="row">
            <div class="small-12">
                <i class="fa fa-github" aria-hidden="true"></i> Check out the <a href="https://github.com/ganderzz/DyLang">GitHub</a> for more info!
            </div>
        </div>

        <script>
            window.onload = function() {
                var resultField = document.querySelector("#code__result");

                console.log = function(value) {
                    resultField.innerHTML = value;
                }

                document.querySelector("button").addEventListener("click", function() {
                    var code = document.querySelector("#code").value;
                    var compiled = compile(code);

                    eval(compiled)
                });
            }
        </script>

    <script>
        function tokenize(input){let current=0;const tokens=[];while(current<input.length){const currentElement=input[current];if(currentElement==="#"){current++;if(input[current]==="#"){current++;while(input[current++]!=="#"){}}else{while(input[current]!=="\n"){current++}}
continue}
if(/\s/.test(currentElement)){current++;continue}
if(/[0-9]/.test(currentElement)){let value="";while(/[0-9]/.test(input[current])){value+=input[current];current++}
tokens.push({type:"number",value:parseInt(value,10)});continue}
if(currentElement==="$"){current++;let variableName="";while(/[a-z]/i.test(input[current])){variableName+=input[current];current++}
tokens.push({type:"variable",value:variableName});continue}
if(currentElement==="="){current++;tokens.push({type:"assignment"});continue}
if(currentElement==="'"){let value="";current++;while(input[current]!=="'"){value+=input[current];current++}
current++;tokens.push({type:"string",value:value});continue}
if(currentElement==="("){tokens.push({type:"paren",value:currentElement});current++;continue}
if(currentElement===")"){tokens.push({type:"paren",value:currentElement});current++;continue}
const characters=/[a-z\.]/i;if(characters.test(currentElement)){let value=currentElement;while(characters.test(input[++current])){value+=input[current]}
tokens.push({type:"name",value:value});continue}}
return tokens}
function parser(tokens){let current=0;function walk(){let token=tokens[current];switch(token.type){case "number":current++;return{type:"NumberLiteral",token:token.value};case "string":current++;return{type:"StringLiteral",token:token.value};case "variable":let node={type:"Variable",name:token.value,value:[]};token=tokens[++current];if(token.type==="assignment"){token=tokens[++current];node.value.push(walk())}
return node;case "paren":if(token.value==="("){token=tokens[++current];let node={type:"CallExpression",name:token.value,params:[],};token=tokens[++current];while((token.type!=="paren")||(token.type==="paren"&&token.value!==")")){node.params.push(walk());token=tokens[current]}
current++;return node}}
throw new TypeError("Invalid Type: "+token.type)}
let ast={type:"Program",body:[]};while(current<tokens.length){ast.body.push(walk())}
return ast}
function traverser(ast,visitor){function traverseArray(array,parent){array.forEach((child)=>{traverseNode(child,parent)})}
function traverseNode(node,parent){if(!node){return}
let methods=visitor[node.type];if(methods&&methods.enter){methods.enter(node,parent)}
switch(node.type){case "Program":traverseArray(node.body,node);break;case "CallExpression":traverseArray(node.params,node);break;case "Variable":traverseArray(node.value,node);break;case "StringLiteral":case "NumberLiteral":break;default:throw new TypeError(node+" is invalid in traverser")}
if(methods&&methods.exit){methods.exit(node,parent)}}
traverseNode(ast,null)}
function transformer(ast){let newAst={type:"Program",body:[]}
ast._context=newAst.body;traverser(ast,{NumberLiteral:{enter(node,parent){parent._context.push({type:"NumberLiteral",value:node.token})}},StringLiteral:{enter(node,parent){parent._context.push({type:"StringLiteral",value:node.token})}},Variable:{enter(node,parent){let expression={type:"Variable",name:{type:"Identifier",name:node.name},value:[]};node._context=expression.value;if(node.value!=="CallExpression"){expression={type:"Assignment",expression:expression}}
if(!node.value){expression={type:"Variable",name:node.name}}
parent._context.push(expression)}},CallExpression:{enter(node,parent){let expression={type:"CallExpression",callee:{type:"Identifier",name:node.name,},arguments:[],};node._context=expression.arguments;if(parent.type!=="CallExpression"){expression={type:"ExpressionStatement",expression:expression,}}
parent._context.push(expression)}}});return newAst}
function generator(node){switch(node.type){case "Program":return node.body.map(generator).join("");case "ExpressionStatement":return generator(node.expression)+";";case "CallExpression":return(generator(node.callee)+"("+node.arguments.map(generator)+")");case "Assignment":return(generator(node.expression));case "Variable":if(node.value.length>0){return `var ${generator(node.name)} = ${node.value.map(generator)};`}
return generator(node.name);case "Identifier":return node.name;case "NumberLiteral":return node.value;case "StringLiteral":return '"'+node.value+'"'}}
function compile(code){const t=tokenize(code);const p=parser(t);const tr=transformer(p);const g=generator(tr);return g}
function add(a,b){return a+b}
function subtract(a,b){return a-b}
function multiply(a,b){return a*b}
function divide(a,b){return a/b}
function getElementById(id){return document.getElementById(id)}
function print(...input){console.log(input.join(" "))}
function writeTo(elem,input){elem.innerHTML=input}
    </script>
    </body>
</html>