var dylang=(()=>{var A=Object.defineProperty;var C=Object.getOwnPropertyDescriptor;var D=Object.getOwnPropertyNames;var L=Object.prototype.hasOwnProperty;var P=(a,t)=>{for(var r in t)A(a,r,{get:t[r],enumerable:!0})},O=(a,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let e of D(t))!L.call(a,e)&&e!==r&&A(a,e,{get:()=>t[e],enumerable:!(i=C(t,e))||i.enumerable});return a};var B=a=>O(A({},"__esModule",{value:!0}),a);var T={};P(T,{compile:()=>F});function p(a){if(!a)return"";switch(a.type){case"Program":return`(function(){${a.body.map(p).join("")}})();`;case"Assignment":case"ExpressionStatement":return p(a.expression);case"CallExpression":let t=(a.callee?a.callee.value:a.name)+"(";return a.params&&(t+=a.params.map(p).join(",")),a.arguments&&(t+=a.arguments.map(p).join(",")),t+=")",t;case"Return":return`return ${a.value.map(p).join(" ")};`;case"Function":return`function ${a.name.value}() {${a.body.map(p).join(" ")}}`;case"Variable":return a.value.length>0?`var ${p(a.name)}=${a.value.map(p).join(" ")};`:p(a.name);case"IfStatement":return`if(${a.conditional.map(p).join(" ")}){${a.body.map(p).join(" ")}}`;case"ElseStatement":return`else{${a.body.map(p).join(" ")}}`;case"Identifier":case"DecimalLiteral":case"NumberLiteral":case"BooleanLiteral":case"Operator":return a.value;case"StringLiteral":return'"'+a.value+'"'}}function N(a){let t=0;function r(){let e=a[t];switch(e.type){case 8:return t++,{type:"NumberLiteral",value:e.value};case 9:return t++,{type:"DecimalLiteral",value:e.value};case 5:return t++,{type:"StringLiteral",value:e.value};case 3:return t++,{type:"Operator",value:e.value};case 17:let c={type:"Return",value:[]};for(e=a[++t];e.type!==4;){if(!e||!e.type)throw new Error("Found infinite loop... bailing");c.value.push(r()),e=a[t]}return t++,c;case 16:if(t++,a[t].type!==2)throw new Error("Missing identifier after function declaration");let s={type:"Function",name:a[t],arguments:[],body:[],returnType:"auto"};for(t++;a[t].type!==11;){if(!a[t])throw new Error("Could not find the start of the function");a[t].type===0?(t++,s.arguments.push(r())):(a[t].type===18&&(s.returnType=a[t].value),t++)}t++;let n=1;for(;a[t]&&n>0;)if(a[t].type===12)n--,t++;else if(a[t].type===11)n++,t++;else{let y=r();y&&s.body.push(y)}return s;case 7:let m={type:"Variable",name:e.value,valueType:e.valueType,value:[]};if(e=a[++t],e.type===6){for(e=a[++t];e.type!==4;)m.value.push(r()),e=a[t];t++}return m;case 2:t++;let l={type:"Identifier",value:a[t-1].value};if(a[t].type===0){t++;let y={type:"CallExpression",callee:l,arguments:[],expression:null};return y.arguments.push(r()),y}return l;case 15:return t++,{type:"Separator"};case 10:let f={type:"IfStatement",conditional:[],body:[]};for(e=a[++t];e.type!==11;)f.conditional.push(r()),e=a[t];for(e=a[++t];e.type!==12;)f.body.push(r()),e=a[t];return e=a[++t],f;case 14:let R={type:"ElseStatement",body:[]};for(e=a[++t];e.type!==11;)e=a[++t];for(t++;e.type!==12;)R.body.push(r()),e=a[t];return e=a[++t],R;case 4:case 11:case 12:case 0:case 1:t++;return}throw new TypeError("Invalid Type: "+e?e.type:e)}let i={type:"Program",body:[]};for(;t<a.length;)i.body.push(r());return i}function g(a,t){function r(e,c){e.forEach(s=>{i(s,c)})}function i(e,c){if(!e||!e.type)return;let s=t[e.type];switch(s&&s.enter&&s.enter(e,c),e.type){case"CallExpression":r(e.arguments,e);break;case"Variable":case"Return":r(e.value,e);break;case"Program":case"Function":case"ElseStatement":case"IfStatement":r(e.body,e);break;case"Separator":case"DecimalLiteral":case"StringLiteral":case"NumberLiteral":case"Operator":case"Identifier":case"None":break;default:throw new TypeError(e.type+" is invalid in traverser")}s&&s.exit&&s.exit(e,c)}i(a,null)}function I(a){let t={type:"Program",body:[]};return a._context=t.body,g(a,{NumberLiteral:{enter(r,i){i._context.push(r)}},DecimalLiteral:{enter(r,i){i._context.push(r)}},StringLiteral:{enter(r,i){i._context.push(r)}},Operator:{enter(r,i){i._context.push(r)}},Identifier:{enter(r,i){i._context.push(r)}},Separator:{enter(r,i){i._context.push(r)}},Return:{enter(r,i){r._context=[],i._context.push(r)}},Variable:{enter(r,i){let e={type:"Variable",name:{type:"Identifier",value:r.name},value:[]};r._context=e.value,r.value!=="CallExpression"&&(e={type:"Assignment",expression:e}),r.value||(e={type:"Variable",name:r.name}),i._context.push(e)}},Function:{enter(r,i){r._context=[],i._context.push(r)}},IfStatement:{enter(r,i){let e={type:"IfStatement",conditional:r.conditional,body:[]};r._context=e.body,i._context.push(e)}},ElseStatement:{enter(r,i){let e={type:"ElseStatement",body:[]};r._context=e.body,i._context.push(e)}},CallExpression:{enter(r,i){let e={type:"CallExpression",callee:r.callee,arguments:[],expression:null};r._context=e.arguments,i._context.push(e)}}}),t}function b({cursor:a}){return{tokens:[{type:11}],cursor:a+1}}function d({cursor:a}){return{tokens:[{type:16}],cursor:a+2}}var o={int:"int",string:"string",decimal:"decimal",variable:"let",colon:":",forwardSlash:"/",backwardSlash:"\\",rightBace:"{",leftBrace:"}",leftParen:"(",rightParen:")",function:"fn",if:"if",else:"else",return:"return",equals:"=",quote:'"'};function E(a,t){for(let r=0;t[r]!==" "&&r<t.length;r++)if(a[r]!==t[r])return!1;return!0}function x(a){let t=[],r=a.split(`
`),i=!1;for(let e=0,c=r.length;e<c;e++){let s=r[e].length,n=0,m=0;for(;n<s;){let l=r[e][n],f=r[e].slice(n);if(i&&l!=="*"){n++;continue}else if(i&&l==="*"&&r[e][n+1]===o.forwardSlash){i=!1,n+=2;continue}if(l===o.forwardSlash&&r[e][n+1]===o.forwardSlash)break;if(l===o.forwardSlash&&r[e][n+1]==="*"){n+=2,i=!0;continue}if(/\s/.test(l)){n++;continue}if(E(o.return,f)){n+=6,t.push({type:17});continue}if(l===o.colon){n++;let u="";for(/\s/.test(r[e][n])&&n++;!/\s/.test(r[e][n])&&!(r[e][n]==="{"||r[e][n]===",");)u+=r[e][n++];t.push({type:18,value:u.length===0?"auto":u});continue}if(/[0-9]/.test(l)){let u=r[e][n];for(n++;/[0-9]/.test(r[e][n]);)u+=r[e][n],n++;if(r[e][n]==="."){for(u+=".",n++;/[0-9]/.test(r[e][n]);)u+=r[e][n],n++;t.push({type:9,value:parseFloat(u)});continue}t.push({type:8,value:parseInt(u,10)});continue}if(l===o.rightBace){let{tokens:u,cursor:h}=b({cursor:n});u.forEach(v=>t.push(v)),n=h;continue}if(l===o.leftBrace){n++,t.push({type:12});continue}if(E(o.function,f)){let{tokens:u,cursor:h}=d({cursor:n});u.forEach(v=>t.push(v)),n=h;continue}if(E(o.if,f)){n+=2,t.push({type:10});continue}if(E(o.else,f)){n+=4,t.push({type:14});continue}if(E(o.int,f)||E(o.decimal,f)||E(o.string,f)||E(o.variable,f)){let u="",h="";for(;n<s&&r[e][n]!==" ";)u+=r[e][n],n++;for(n++;n<s&&/[a-z]/i.test(r[e][n]);)h+=r[e][n],n++;if(!h)throw new Error("Undeclared variable being used on line "+(e+1)+":"+n);t.push({type:7,valueType:u,value:h});continue}if(l===o.equals){if(r[e][n+1]===o.equals){n+=2,t.push({type:3,value:"=="});continue}n++,t.push({type:6});continue}if(l===o.quote){let u="",h=1;for(n++;h>0;){if(n>s)throw new SyntaxError("Expecting a closing ' on line "+(e+1)+":"+n+" near "+r[e]);r[e][n]===o.quote&&r[e][n-1]!=="\\"?h--:u+=r[e][n++]}n++,t.push({type:5,value:u});continue}if(l===o.leftParen){n++,m++,t.push({type:0,value:l});continue}if(l===o.rightParen){if(m===0)throw new Error("Expecting ( on line "+(e+1)+":"+n);n++,m--,t.push({type:1,value:l});continue}let R=/[a-z\.]/i;if(R.test(l)){let u=l;for(n++;r[e][n]&&R.test(r[e][n]);)u+=r[e][n],n++;t.push({type:2,value:u});continue}let y=/[\+\-\*\/\%\<\>\!]/i;if(l.match(y)){n++;let u=l.match(/[\!\<\>]/);if(u&&r[e][n]==="="){n++,t.push({type:3,value:`${u[0]}=`});continue}t.push({type:3,value:l});continue}if(l.match(",")){n++,t.push({type:15});continue}throw new TypeError("Invalid symbol "+r[e][n]+" given on line "+(e+1)+":"+n+" around "+r[e])}t.length>0&&t.push({type:4})}if(i)throw new Error("A multi-line comment was started, but never closed");return t}function S(a,t,r,i){let e=a.map(c=>c.value?c.value:c.token).join(" ");return new TypeError(`${t.type} [${t.token}] is being assigned to a ${r} near [${e}]. (${i+1}:0)`)}function _(a){let t=a.body,r={};function i(e,c){if(!e||!e.valueType)return;let s=e.valueType,n=e.value;if(r[e.name])throw new Error(`Immutable variable [${e.name}] reassigned. (${c+1}:0)`);if(r[e.name]=s,s!=="let")for(let m=0;m<n.length;m++){let l=n[m];if(!(l.type==="Operator"&&l.type==="Variable"&&l.type==="CallExpression")){if(l.type==="Identifier"){let f=r[l.value];if(f!==s)throw new TypeError(`
            Variable [${l.value}] of type ${s} cannot be assigned to ${f}. (${c+1}:0)`);continue}switch(l.type){case"NumberLiteral":if(s!=="int")throw S(n,l,s,c);break;case"DecimalLiteral":if(s!=="decimal")throw S(n,l,s,c);break;case"StringLiteral":if(s!=="string")throw S(n,l,s,c);break}}}}t.map(i)}function $(a){switch(a?a.toLowerCase():""){case"js":return p}throw new Error("Invalid generator output type given.")}var F=(a,t={output:"js"})=>{let r=x(a),i=N(r);_(i);let e=I(i);return $(t&&t.output)(e)};return B(T);})();
